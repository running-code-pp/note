# asio中常见的错误码

- asio::error::operation_aborted - 操作被取消
- asio::error::connection_refused - 连接被拒绝
- asio::error::eof - 到达文件末尾（连接关闭）
- asio::error::timed_out - 操作超时
- asio::error::connection_reset - 连接被重置
- asio::error::host_unreachable - 主机不可达

# 致命错误和非致命错误
- 致命错误：程序无法继续执行，如内存不足、配置错误等
- 非致命错误：可以恢复或降级处理的错误，如连接超时、临时网络故障等

# 异常处理机制

```cpp
// 定义自定义异常类
class NetworkException : public std::runtime_error {
public:
  NetworkException(const std::string& message, int error_code = 0)
    : std::runtime_error(message), error_code_(error_code) {}
  
  int get_error_code() const { return error_code_; }
  
private:
  int error_code_;
};

class ConnectionException : public NetworkException {
public:
  ConnectionException(const std::string& message, const std::string& host, short port, int error_code = 0)
    : NetworkException(message, error_code), host_(host), port_(port) {}
  
  const std::string& get_host() const { return host_; }
  short get_port() const { return port_; }
  
private:
  std::string host_;
  short port_;
};

// 在不同层次捕获异常
void network_operation() {
  try {
    // 执行网络操作...
  } catch (const ConnectionException& e) {
    std::cerr << "Connection error to " << e.get_host() << ":" << e.get_port() 
              << ": " << e.what() << " (code: " << e.get_error_code() << ")" << std::endl;
    // 特定的连接错误处理
  } catch (const NetworkException& e) {
    std::cerr << "Network error: " << e.what() << " (code: " << e.get_error_code() << ")" << std::endl;
    // 通用的网络错误处理
  } catch (const std::exception& e) {
    std::cerr << "Unexpected error: " << e.what() << std::endl;
    // 未预期的异常处理
  } catch (...) {
    std::cerr << "Unknown error occurred" << std::endl;
    // 未知异常处理
  }
}

// 将Asio错误码转换为异常
void throw_if_error(const asio::error_code& ec, const std::string& error_message) {
  if (ec) {
    // 根据错误码类型抛出不同的异常
    if (ec == asio::error::connection_refused || 
        ec == asio::error::connection_reset || 
        ec == asio::error::connection_aborted) {
      throw ConnectionException(error_message + ": " + ec.message(), 
                              "unknown", 0, ec.value());
    } else {
      throw NetworkException(error_message + ": " + ec.message(), ec.value());
    }
  }
}

// 在Asio回调中使用异常处理
void safe_asio_callback(const asio::error_code& ec) {
  try {
    throw_if_error(ec, "Asio operation failed");
    
    // 继续处理...
    std::cout << "Operation completed successfully" << std::endl;
  } catch (const std::exception& e) {
    std::cerr << "Error in callback: " << e.what() << std::endl;
    // 在回调中处理异常，不要让它传播出去
  }
}
```